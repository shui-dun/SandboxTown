# TODO

## feature

- 各种精灵（例如狗）在地图上的数目过少时，会重新生成一些
- java bean继承，例如使用 `new SpriteEffectChangeVo(spriteId)` 替代 `new WSResponseVo(WSResponseEnum.SPRITE_EFFECT_CHANGE, new SpriteEffectChangeVo(spriteId))`，其中 `SpriteEffectChangeVo` 继承自 `WSResponseVo`
- 完成虚无的效果
- 只有晚上会生成一些怪（例如蜘蛛） & 黎明时怪开始迅速受伤死亡（烧伤效果）
- 多地图（一个Java服务器负责一个地图） & rest请求用nginx做负载均衡
- Redis做缓存（简单的用cachable注解，复杂的写代码）
- 自动生成各种枚举类（可借助rest api）
- 优化自动生成各个说明文档（可借助rest api），这些生成脚本不应该删除已有的介绍内容，例如对狗狗行为规则的介绍，同时应该展示物品的详细信息（例如给精灵带来的效果）
- 使用spring cloud, k8s替代docker-compose
- 添加修炼场：一个修炼场所，精灵呆在里面一定时间可以获得特殊效果，例如“一定概率秒杀对方”或者“经验球”，或者直接获得经验值更方便
- 使用ai p图，生成各个精灵的各种动作的图片，例如行走（各个方向）、攻击、受伤、死亡等
- 设计以下武器（prompt：cute cartoon dog, white background, Illustration, Graphic Design, Minimalism, simple, color, front view）：
  - 埃阿斯之盾：体力上限+7，受到伤害时50%概率将伤害值+1后反弹给攻击者
  - 雷霆之杖（LightningBolts）：无视对方防具，并对对方造成30s烧伤效果
  - 青龙偃月刀：一定概率秒杀对方
  - 湖中剑：造成特定数值的固定伤害
  - 荷鲁斯之眼：生命和饱腹值恢复到满，并带有30s生命效果
- 添加额外效果表(item_type_extra_effect)，例如对于埃阿斯之盾的“受到伤害时50%概率将伤害值+1后反弹给攻击者”的效果，后端计算时是直接if(装备名)来触发，而不是通过if(effect)来触发，前端效果列表中也不会显示，只是在前端的物品详细列表中会展示。
- 添加音频素材（jsfxr）
- 对于效果，设计一个value值和等级值，例如不同等级的“生命”效果回复速度不同
- 待定：简化设计，废弃整个物理引擎（因为bug太多了，不仅要解决自己代码的bug，还要解决物理引擎的上游bug），进而，可以简化前后端交互（废弃COORDINATE request，服务器不再需要通过前端获得位置信息）和后端设计（废弃SpriteCache，因为SpriteCache的主要目的就是缓存精灵位置，便于COORDINATE）
- 各个精灵类型应有各自的basic生命上限和basic饱腹值上限，各个精灵应有hpLimit，hpLimitInc，hungerLimit 和 hungerLimitInc属性，而不应该是简单的100
- 在游戏启动时,可以使用多线程或异步IO的方式,并行加载地图、精灵、物品数据,减少启动时间。
- 玩家对怪造成伤害，会增加自己的经验值
- 玩家杀死怪时，会增加自己的经验值和金钱
- 竞技场：类似赛尔号
- 使用柏林噪声生成不同的地形
- 需要邀请码才能注册，管理员可以查看、添加和删除邀请码
- 面板界面太长时可以滚动
- 增加成就模块，一些功能需要解锁特定成就才能进行
- 远程攻击：发射子弹，空气阻力很小，并且不透明度与速度正相关，通过服务器同步，但是服务器本身不需要保存子弹的状态，只用在客户端进行碰撞检测
- 实现范围攻击
- 添加聊天模块（移动端也要支持）：
  - 玩家之间可以聊天
  - 玩家也可以广播消息
  - 聊天内容会被保留7天
- 角色的等级提升会解锁之前不能购买的商品或者是工厂里不能制作的东西
- 完成池塘 & 猫会不定期为你捕鱼，并且跑得很快，较难被攻击到
- 玩家养的牛可以宰杀，收获牛革和牛肉，牛革可以做皮质胸甲以及其他物品
- 牛会在草地附近移动，在草地附近才会繁殖，牛有寿命，牛也不能被怪物或其他玩家攻击
- 游戏中可以加入基于ChatGPT的AI虚拟人物，这些AI可以自由活动，也可以和玩家进行交互
- 玩家第1次作弊（例如瞬移）会被警告，第2次封号7天，第3次封号30天，第4次永久封号
- 建筑模块
  - 建筑包含商店、农田、树、草地、池塘、工厂、铁矿、围墙等
  - 玩家可以采集材料、建造建筑
  - 建筑可以升级，提高产出和效率
  - 动物园可以买动物
  - 建筑和神奇物品由工厂制造
  - 只有集市中，玩家可以以任意价格卖出商品，等待其他玩家购买
  - 池塘可以捕鱼（需要手持鱼竿），需要花费一定时间，玩家创建的池塘，如果被别人捕鱼，自己也会获得部分收益（金钱和经验值）
  - 铁矿可以挖铁（需要手持锄头），需要花费一定时间，玩家创建的铁矿，如果被别人挖铁，自己也会获得部分收益（金钱和经验值）
  - 树可以用来砍（手持锯子时）或摘苹果（手不持锯子时），需要花费一定时间，玩家种植的树，如果被别人使用，自己也会获得部分收益（金钱和经验值）
  - 工厂可以使用各种物品合成各种商店买不到的东西，例如各种建筑或珍贵物品，玩家自己创建的工厂，当发生交易时，自己会获得部分收益（金钱和经验值）
  - 希腊神庙，怪物无法靠近
  - 这些建筑里面可获得的东西，量都是有限的，当然也会定期（例如黎明的瞬间）自动补充
  - 玩家建造建筑是，如何检测位置是否合法？
    - 法一：弄一个polygon然后检测碰撞？注意不要与建筑之外的东西产生碰撞，也就是，还需要弄mask
    - 法二（简单些）：将建筑的黑白图的白色变成透明，随后，建造建筑时就跟随光标显示这个图，为方便起见，只在服务器检测位置是否合法

## bug

- 前端和后端有时有空指针异常（例如对spriteCache修改过程中另一个线程使这个精灵下线），如何空安全？是否/如何加锁？例如，对cache的读写（不管是通过GameCache.spriteCacheMap还是通过sprite.getCache()）都应该加锁。（虽然GameCache.spriteCacheMap是ConcurrentHashMap，但是这只能保证其 put, remove, get 的正常，但它并没有提供对其存储的值的读写锁）
- 补间动画的精灵碰撞到带有速度的精灵，补间动画的精灵会再也无法正常运动，尝试在补间动画之前将速度设为0，这样的效果稍微好点，在碰到移动的物体后会像撞到一堵墙一样停止，但之后尝试运动还是可以正常运动，但目前能想到的最好的方法是在update中一直将补间动画的精灵的速度设为0
- 切换账号后，操纵的还是旧的玩家（旧的ws没有断开），需要刷新网页才能避免这个问题
- 服务器部署在海外时延迟高，精灵运动卡顿
- 移动端的问题（感觉难以解决，因此移动端可能只能聊天，不能进行游戏）：
  - 手机端的各个面板无法完整展示（太大）
  - 手机端的狗不会跟随主人移动，也不能与之进行交互，并且在其他用户的手机上这些狗也不可见
  - 手机端主页背景（小球运动）卡顿



